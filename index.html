<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Moshniki Arcade Writer</title>
    <style>
        body {
            margin: 0;
            background-color: #1a1a1a;
            color: #e0e0e0;
            font-family: 'Courier New', Courier, monospace;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            height: 100vh;
        }

        /* The Header / Toolbar */
        header {
            padding: 15px 30px;
            background: #111;
            border-bottom: 2px solid #333;
            display: flex;
            justify-content: space-between;
            align-items: center;
            z-index: 10;
        }

        h1 {
            margin: 0;
            font-size: 1.2rem;
            color: #00bcd4;
            text-transform: uppercase;
            letter-spacing: 2px;
        }

        .actions button {
            background: #333;
            color: #fff;
            border: 1px solid #555;
            padding: 8px 15px;
            margin-left: 10px;
            cursor: pointer;
            font-family: inherit;
            font-size: 0.9rem;
            transition: all 0.2s;
        }

        .actions button:hover {
            background: #00bcd4;
            color: #000;
            border-color: #00bcd4;
        }

        /* The Typing Area */
        #editor-container {
            flex-grow: 1;
            position: relative;
            padding: 40px;
            overflow-y: auto;
            max-width: 800px;
            margin: 0 auto;
            width: 100%;
            box-sizing: border-box;
        }

        #editor {
            width: 100%;
            min-height: 80vh;
            border: none;
            outline: none;
            background: transparent;
            color: #eee;
            font-size: 1.2rem;
            line-height: 1.6;
            white-space: pre-wrap;
            z-index: 5;
            position: relative;
        }

        #editor:empty:before {
            content: "Start typing... (Sound on for best experience)";
            color: #555;
        }

        /* Canvas for Particle Effects */
        #particle-canvas {
            position: fixed;
            top: 0;
            left: 0;
            pointer-events: none;
            z-index: 100;
        }

        /* Screen Shake Animation */
        .shake {
            animation: shake 0.1s cubic-bezier(.36,.07,.19,.97) both;
        }

        @keyframes shake {
            10%, 90% { transform: translate3d(-1px, 0, 0); }
            20%, 80% { transform: translate3d(2px, 0, 0); }
            30%, 50%, 70% { transform: translate3d(-2px, 0, 0); }
            40%, 60% { transform: translate3d(2px, 0, 0); }
        }
    </style>
</head>
<body>

    <header>
        <h1>Moshniki Writer</h1>
        <div class="actions">
            <button onclick="toggleSound()">Mute Sound</button>
            <button onclick="copyText()">Copy Text</button>
            <button onclick="downloadText()">Save as .txt</button>
        </div>
    </header>

    <div id="editor-container">
        <div id="editor" contenteditable="true" spellcheck="false"></div>
    </div>

    <canvas id="particle-canvas"></canvas>

    <script>
        const editor = document.getElementById('editor');
        const canvas = document.getElementById('particle-canvas');
        const ctx = canvas.getContext('2d');
        
        let width = window.innerWidth;
        let height = window.innerHeight;
        canvas.width = width;
        canvas.height = height;

        let particles = [];
        let soundEnabled = true;

        // --- Audio Context for Synthetic Sounds ---
        const AudioContext = window.AudioContext || window.webkitAudioContext;
        const audioCtx = new AudioContext();

        function playClickSound() {
            if (!soundEnabled) return;
            if (audioCtx.state === 'suspended') audioCtx.resume();

            const osc = audioCtx.createOscillator();
            const gainNode = audioCtx.createGain();

            // Create a short, sharp "click" or "thock" sound
            osc.type = 'triangle';
            osc.frequency.setValueAtTime(Math.random() * 50 + 300, audioCtx.currentTime); // variation
            
            gainNode.gain.setValueAtTime(0.1, audioCtx.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(0.001, audioCtx.currentTime + 0.1);

            osc.connect(gainNode);
            gainNode.connect(audioCtx.destination);

            osc.start();
            osc.stop(audioCtx.currentTime + 0.1);
        }

        function toggleSound() {
            soundEnabled = !soundEnabled;
            document.querySelector("button").innerText = soundEnabled ? "Mute Sound" : "Enable Sound";
        }

        // --- Particle System ---
        class Particle {
            constructor(x, y) {
                this.x = x;
                this.y = y;
                this.size = Math.random() * 3 + 1;
                this.speedX = Math.random() * 4 - 2;
                this.speedY = Math.random() * 4 - 2;
                // Random neon colors
                const colors = ['#00bcd4', '#ff4081', '#76ff03', '#ffffff'];
                this.color = colors[Math.floor(Math.random() * colors.length)];
                this.life = 1.0;
            }

            update() {
                this.x += this.speedX;
                this.y += this.speedY;
                this.life -= 0.05;
                this.size *= 0.95;
            }

            draw() {
                ctx.fillStyle = this.color;
                ctx.globalAlpha = this.life;
                ctx.beginPath();
                ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
                ctx.fill();
            }
        }

        function animateParticles() {
            ctx.clearRect(0, 0, width, height);
            for (let i = 0; i < particles.length; i++) {
                particles[i].update();
                particles[i].draw();
                if (particles[i].life <= 0) {
                    particles.splice(i, 1);
                    i--;
                }
            }
            requestAnimationFrame(animateParticles);
        }
        animateParticles();

        // --- Typing Logic ---
        // Helper to get caret coordinates
        function getCaretCoordinates() {
            let x = 0, y = 0;
            const selection = window.getSelection();
            if (selection.rangeCount !== 0) {
                const range = selection.getRangeAt(0).cloneRange();
                range.collapse(true);
                const rect = range.getClientRects()[0];
                if (rect) {
                    x = rect.left;
                    y = rect.top;
                }
            }
            return { x, y };
        }

        editor.addEventListener('input', (e) => {
            playClickSound();
            
            // Spawn particles
            const { x, y } = getCaretCoordinates();
            if (x && y) {
                for (let i = 0; i < 5; i++) {
                    particles.push(new Particle(x, y + 10));
                }
            }

            // Screen Shake
            document.body.classList.add('shake');
            setTimeout(() => {
                document.body.classList.remove('shake');
            }, 100);
        });

        // Resize handler
        window.addEventListener('resize', () => {
            width = window.innerWidth;
            height = window.innerHeight;
            canvas.width = width;
            canvas.height = height;
        });

        // --- Toolbar Functions ---
        function copyText() {
            const text = editor.innerText;
            navigator.clipboard.writeText(text).then(() => {
                alert('Text copied to clipboard!');
            });
        }

        function downloadText() {
            const text = editor.innerText;
            const element = document.createElement('a');
            element.setAttribute('href', 'data:text/plain;charset=utf-8,' + encodeURIComponent(text));
            element.setAttribute('download', 'moshniki_notes.txt');
            element.style.display = 'none';
            document.body.appendChild(element);
            element.click();
            document.body.removeChild(element);
        }
    </script>
</body>
</html>
