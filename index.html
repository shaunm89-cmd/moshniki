<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Moshnikiâ€™s Budget Planner</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>

  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>

  <style>
    body {
      margin: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
      background: radial-gradient(circle at top, #0f172a, #020617);
      color: #e5e7eb;
    }

    .app {
      display: grid;
      grid-template-columns: 260px 1fr;
      height: 100vh;
    }

    aside {
      background: linear-gradient(180deg, #020617, #020617dd);
      padding: 20px;
      border-right: 1px solid #1e293b;
    }

    h1 {
      font-size: 18px;
      margin-bottom: 20px;
    }

    button {
      background: #0ea5e9;
      border: none;
      padding: 10px 14px;
      border-radius: 10px;
      color: black;
      font-weight: 600;
      cursor: pointer;
    }

    button.secondary {
      background: #020617;
      color: #e5e7eb;
      border: 1px solid #1e293b;
    }

    main {
      padding: 30px;
      overflow-y: auto;
    }

    .cards {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 16px;
      margin-bottom: 20px;
    }

    .card {
      background: linear-gradient(180deg, #020617, #020617cc);
      border: 1px solid #1e293b;
      border-radius: 16px;
      padding: 16px;
    }

    .card h3 {
      margin: 0 0 6px;
      font-size: 13px;
      color: #94a3b8;
    }

    .card .value {
      font-size: 22px;
      font-weight: 700;
    }

    .layout {
      display: grid;
      grid-template-columns: 2fr 1fr;
      gap: 20px;
    }

    input, select {
      width: 100%;
      padding: 10px;
      border-radius: 10px;
      border: 1px solid #1e293b;
      background: #020617;
      color: #e5e7eb;
    }

    .bill-row {
      display: grid;
      grid-template-columns: 1fr 120px 80px;
      gap: 10px;
      margin-bottom: 10px;
    }

    .bill-row button {
      background: #ef4444;
      color: white;
    }

    .muted {
      color: #94a3b8;
      font-size: 13px;
    }
  </style>
</head>

<body>
<div class="app">
  <aside>
    <h1>Moshnikiâ€™s Budget</h1>
    <button id="authBtn">Sign in with Google</button>
  </aside>

  <main>
    <div class="cards">
      <div class="card"><h3>Income</h3><div class="value" id="incomeTotal">$0</div></div>
      <div class="card"><h3>Bills</h3><div class="value" id="billsTotal">$0</div></div>
      <div class="card"><h3>Savings</h3><div class="value" id="savingsTotal">$0</div></div>
      <div class="card"><h3>Leftover</h3><div class="value" id="leftoverTotal">$0</div></div>
    </div>

    <div class="layout">
      <div class="card">
        <h3>Bills</h3>
        <div id="bills"></div>
        <button onclick="addBill()">+ Add bill</button>
      </div>

      <div class="card">
        <h3>Summary</h3>
        <label class="muted">Pay date</label>
        <input type="date" id="payDate"/>

        <label class="muted">Pay frequency</label>
        <select id="frequency">
          <option value="weekly">Weekly</option>
          <option value="fortnightly">Fortnightly</option>
        </select>

        <label class="muted">Income</label>
        <input type="number" id="income"/>

        <label class="muted">Savings</label>
        <input type="number" id="savings"/>

        <button style="margin-top:12px" onclick="saveBudget()">Save</button>
      </div>
    </div>
  </main>
</div>

<script>
  // ðŸ”¥ FIREBASE CONFIG â€” REPLACE WITH YOUR REAL KEYS
  const firebaseConfig = {
    apiKey: "YOUR_KEY",
    authDomain: "YOUR_DOMAIN",
    projectId: "YOUR_PROJECT_ID"
  };

  firebase.initializeApp(firebaseConfig);
  const auth = firebase.auth();
  const db = firebase.firestore();

  let userId = null;
  let bills = [];

  auth.onAuthStateChanged(user => {
    if (!user) return;
    userId = user.uid;
    document.getElementById("authBtn").innerText = "Signed in as " + user.displayName.split(" ")[0];
    document.getElementById("authBtn").disabled = true;
    loadBudget();
  });

  document.getElementById("authBtn").onclick = () => {
    auth.signInWithPopup(new firebase.auth.GoogleAuthProvider());
  };

  function addBill(name = "", amount = 0) {
    bills.push({ name, amount });
    renderBills();
  }

  function renderBills() {
    const container = document.getElementById("bills");
    container.innerHTML = "";
    bills.forEach((b, i) => {
      const row = document.createElement("div");
      row.className = "bill-row";
      row.innerHTML = `
        <input value="${b.name}" onchange="bills[${i}].name=this.value">
        <input type="number" value="${b.amount}" onchange="bills[${i}].amount=+this.value">
        <button onclick="bills.splice(${i},1);renderBills()">X</button>
      `;
      container.appendChild(row);
    });
    updateTotals();
  }

  function updateTotals() {
    const income = +incomeInput.value || 0;
    const savings = +savingsInput.value || 0;
    const billsTotal = bills.reduce((t,b)=>t+(+b.amount||0),0);
    document.getElementById("incomeTotal").innerText = `$${income}`;
    document.getElementById("billsTotal").innerText = `$${billsTotal}`;
    document.getElementById("savingsTotal").innerText = `$${savings}`;
    document.getElementById("leftoverTotal").innerText = `$${income - billsTotal - savings}`;
  }

  const incomeInput = document.getElementById("income");
  const savingsInput = document.getElementById("savings");
  incomeInput.oninput = savingsInput.oninput = updateTotals;

  function saveBudget() {
    if (!userId) return;
    db.collection("users").doc(userId).set({
      payDate: payDate.value,
      frequency: frequency.value,
      income: +incomeInput.value,
      savings: +savingsInput.value,
      bills
    });
    alert("Saved ðŸ‘");
  }

  function loadBudget() {
    db.collection("users").doc(userId).get().then(doc => {
      if (!doc.exists) return;
      const d = doc.data();
      payDate.value = d.payDate || "";
      frequency.value = d.frequency || "weekly";
      incomeInput.value = d.income || 0;
      savingsInput.value = d.savings || 0;
      bills = d.bills || [];
      renderBills();
    });
  }
</script>
</body>
</html>
