<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Compliance & Risk Management</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        :root {
            /* Professional Palette */
            --sidebar-bg: #1e293b; /* Slate 800 */
            --sidebar-text: #cbd5e1;
            --bg-app: #f1f5f9;     /* Slate 100 */
            --bg-surface: #ffffff;
            --primary: #2563eb;    /* Royal Blue */
            --text-main: #334155;  /* Slate 700 */
            --text-light: #64748b; /* Slate 500 */
            --border: #e2e8f0;     /* Slate 200 */
            --success: #10b981;
            --warning: #f59e0b;
            --danger: #ef4444;
            
            --shadow-card: 0 1px 3px 0 rgb(0 0 0 / 0.1), 0 1px 2px -1px rgb(0 0 0 / 0.1);
            --shadow-drawer: -4px 0 24px rgba(0,0,0,0.1);
        }

        body {
            margin: 0;
            font-family: 'Inter', sans-serif;
            background-color: var(--bg-app);
            color: var(--text-main);
            height: 100vh;
            display: flex;
            overflow: hidden;
        }

        /* SIDEBAR */
        aside {
            width: 260px;
            background: var(--sidebar-bg);
            color: white;
            display: flex;
            flex-direction: column;
            flex-shrink: 0;
        }

        .brand {
            padding: 24px;
            font-weight: 700;
            font-size: 1rem;
            letter-spacing: 0.5px;
            color: white;
            border-bottom: 1px solid rgba(255,255,255,0.1);
            display: flex; align-items: center; gap: 10px;
        }

        .nav-menu { padding: 20px 12px; display: flex; flex-direction: column; gap: 4px; }

        .nav-item {
            background: transparent; border: none; color: var(--sidebar-text);
            padding: 12px 16px; text-align: left; cursor: pointer; font-size: 0.9rem;
            border-radius: 6px; font-weight: 500; display: flex; align-items: center; gap: 12px;
            transition: all 0.2s;
        }

        .nav-item:hover { background: rgba(255,255,255,0.05); color: white; }
        .nav-item.active { background: var(--primary); color: white; }

        .user-profile {
            margin-top: auto; padding: 20px; border-top: 1px solid rgba(255,255,255,0.1);
            display: flex; align-items: center; gap: 12px;
        }
        .avatar {
            width: 32px; height: 32px; background: rgba(255,255,255,0.1); border-radius: 50%;
            display: flex; align-items: center; justify-content: center; font-size: 0.8rem; font-weight: 600;
        }

        /* MAIN AREA */
        main { flex: 1; padding: 32px 40px; overflow-y: auto; }

        h1 { font-size: 1.5rem; font-weight: 700; margin: 0 0 24px 0; color: #0f172a; }
        h2 { font-size: 1rem; font-weight: 600; margin-bottom: 16px; color: #0f172a; }

        /* CARDS */
        .card {
            background: var(--bg-surface); border: 1px solid var(--border);
            border-radius: 8px; box-shadow: var(--shadow-card); padding: 24px; margin-bottom: 24px;
        }

        /* STATS SUMMARY */
        .stats-row { display: grid; grid-template-columns: repeat(3, 1fr); gap: 24px; margin-bottom: 32px; }
        .stat-box { background: white; padding: 20px; border-radius: 8px; border: 1px solid var(--border); box-shadow: var(--shadow-card); }
        .stat-label { font-size: 0.85rem; color: var(--text-light); font-weight: 500; text-transform: uppercase; letter-spacing: 0.5px; }
        .stat-val { font-size: 1.8rem; font-weight: 700; margin-top: 8px; color: #0f172a; }

        /* TABLE */
        .table-container { background: white; border: 1px solid var(--border); border-radius: 8px; overflow: hidden; box-shadow: var(--shadow-card); }
        table { width: 100%; border-collapse: collapse; }
        th { text-align: left; padding: 16px 24px; background: #f8fafc; color: var(--text-light); font-weight: 600; font-size: 0.8rem; text-transform: uppercase; border-bottom: 1px solid var(--border); }
        td { padding: 16px 24px; border-bottom: 1px solid var(--border); font-size: 0.9rem; color: var(--text-main); }
        tr:last-child td { border-bottom: none; }
        
        .row-interactive { cursor: pointer; transition: background 0.15s; }
        .row-interactive:hover { background-color: #f1f5f9; }

        .badge {
            display: inline-flex; align-items: center; padding: 4px 10px; border-radius: 99px;
            font-size: 0.75rem; font-weight: 600;
        }
        .badge-gray { background: #f1f5f9; color: #475569; }
        .badge-red { background: #fef2f2; color: #dc2626; }
        .badge-blue { background: #eff6ff; color: #2563eb; }

        /* FORMS */
        .form-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px; }
        label { display: block; margin-bottom: 6px; font-size: 0.85rem; font-weight: 500; color: #334155; }
        input, select, textarea {
            width: 100%; padding: 10px 12px; border: 1px solid var(--border); border-radius: 6px;
            font-size: 0.95rem; font-family: 'Inter', sans-serif; color: #0f172a;
            box-sizing: border-box; transition: all 0.2s;
        }
        input:focus, select:focus, textarea:focus { outline: none; border-color: var(--primary); box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1); }
        
        .btn {
            background: var(--primary); color: white; border: none; padding: 10px 20px;
            border-radius: 6px; font-weight: 500; cursor: pointer; font-size: 0.9rem;
            display: inline-flex; align-items: center; gap: 8px; transition: 0.2s;
        }
        .btn:hover { background-color: #1d4ed8; }
        .btn-secondary { background: white; border: 1px solid var(--border); color: var(--text-main); }
        .btn-secondary:hover { background: #f8fafc; }

        /* SLIDE-OVER DRAWER (The "Bespoke" Detail) */
        .drawer-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(15, 23, 42, 0.4); z-index: 50;
            opacity: 0; visibility: hidden; transition: all 0.3s;
        }
        .drawer-overlay.open { opacity: 1; visibility: visible; }

        .drawer {
            position: fixed; top: 0; right: -600px; width: 550px; height: 100%;
            background: white; box-shadow: var(--shadow-drawer); z-index: 51;
            transition: right 0.3s cubic-bezier(0.16, 1, 0.3, 1);
            display: flex; flex-direction: column;
        }
        .drawer.open { right: 0; }

        .drawer-header {
            padding: 24px; border-bottom: 1px solid var(--border);
            display: flex; justify-content: space-between; align-items: start; background: #f8fafc;
        }
        .drawer-body { padding: 32px; overflow-y: auto; flex: 1; }
        
        .detail-group { margin-bottom: 24px; }
        .detail-label { font-size: 0.75rem; text-transform: uppercase; color: var(--text-light); font-weight: 600; letter-spacing: 0.5px; margin-bottom: 6px; }
        .detail-value { font-size: 1rem; color: #0f172a; line-height: 1.5; }
        
        .file-attachment {
            display: flex; align-items: center; gap: 10px; padding: 12px;
            border: 1px solid var(--border); border-radius: 6px; margin-top: 8px;
        }
        
        /* SEARCH RESULTS */
        .search-result {
            padding: 20px; border-bottom: 1px solid var(--border);
            cursor: pointer; transition: background 0.2s;
        }
        .search-result:last-child { border-bottom: none; }
        .search-result:hover { background: #f8fafc; }

        /* UTILS */
        .section { display: none; }
        .section.active { display: block; animation: fadeIn 0.3s; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }

    </style>
</head>
<body>

<div class="drawer-overlay" id="overlay" onclick="closeDrawer()"></div>
<div class="drawer" id="drawer">
    <div class="drawer-header">
        <div>
            <div style="font-size: 0.8rem; color: var(--text-light); margin-bottom: 4px;">INCIDENT REPORT</div>
            <h2 id="d_name" style="margin:0; font-size:1.25rem;">-</h2>
        </div>
        <button class="btn btn-secondary" style="padding: 6px 12px;" onclick="closeDrawer()"><i class="fa-solid fa-xmark"></i></button>
    </div>
    <div class="drawer-body">
        <div class="form-grid">
            <div class="detail-group">
                <div class="detail-label">Classification</div>
                <div class="detail-value"><span class="badge badge-blue" id="d_type">-</span></div>
            </div>
            <div class="detail-group">
                <div class="detail-label">Date & Time</div>
                <div class="detail-value" id="d_time">-</div>
            </div>
        </div>

        <div class="detail-group">
            <div class="detail-label">Narrative</div>
            <div class="detail-value" id="d_narrative" style="background: #f8fafc; padding: 16px; border-radius: 6px;">-</div>
        </div>

        <div class="detail-group" style="border-top: 1px solid var(--border); padding-top: 20px;">
            <div class="detail-label">Associated Entities</div>
            <div class="detail-value" id="d_associates" style="display:flex; gap: 8px; flex-wrap: wrap; margin-top: 8px;"></div>
        </div>

        <div class="detail-group">
            <div class="detail-label">Machine & Asset Data</div>
            <div class="detail-value" id="d_machine">No machine data recorded.</div>
        </div>

        <div class="detail-group">
            <div class="detail-label">Evidence Files</div>
            <div id="d_files"></div>
        </div>
    </div>
</div>

<aside>
    <div class="brand">
        <i class="fa-solid fa-layer-group" style="color: var(--primary);"></i>
        RISK CONTROL
    </div>
    <div class="nav-menu">
        <button class="nav-item active" onclick="showSection('dashboard', this)">
            <i class="fa-solid fa-chart-pie"></i> Overview
        </button>
        <button class="nav-item" onclick="showSection('new-report', this)">
            <i class="fa-solid fa-file-pen"></i> Submit Report
        </button>
        <button class="nav-item" onclick="showSection('connections', this)">
            <i class="fa-solid fa-magnifying-glass"></i> Intelligence
        </button>
    </div>
    <div class="user-profile">
        <div class="avatar">S</div>
        <div style="font-size: 0.85rem; line-height: 1.3;">
            <div style="font-weight: 600;">Shaun M.</div>
            <div style="color: var(--text-light); font-size: 0.75rem;">Supervisor</div>
        </div>
    </div>
</aside>

<main>
    <div id="dashboard" class="section active">
        <h1>Dashboard</h1>
        
        <div class="stats-row">
            <div class="stat-box">
                <div class="stat-label">Total Reports</div>
                <div class="stat-val" id="totalCount">0</div>
            </div>
            <div class="stat-box">
                <div class="stat-label">Persons of Interest</div>
                <div class="stat-val" id="poiCount">0</div>
            </div>
            <div class="stat-box">
                <div class="stat-label">High Priority</div>
                <div class="stat-val" id="alertCount" style="color: var(--danger);">0</div>
            </div>
        </div>

        <div class="table-container">
            <div style="padding: 20px; border-bottom: 1px solid var(--border); display: flex; justify-content: space-between; align-items: center;">
                <h2 style="margin:0; font-size: 1rem;">Recent Incidents</h2>
                <button class="btn btn-secondary" style="font-size: 0.8rem; padding: 6px 12px;">Export CSV</button>
            </div>
            <div id="table-wrapper"></div>
        </div>
    </div>

    <div id="new-report" class="section">
        <h1>New Incident Report</h1>
        <form id="smrForm" onsubmit="submitReport(event)" style="max-width: 800px;">
            
            <div class="card">
                <h2>Subject Details</h2>
                <div class="form-grid">
                    <div><label>Full Name</label><input type="text" id="poiName" required placeholder="Surname, First Name"></div>
                    <div><label>Identification</label><input type="text" id="poiId" placeholder="Drivers License / Member ID"></div>
                </div>
            </div>

            <div class="card">
                <h2>Incident Details</h2>
                <div class="form-grid">
                    <div><label>Date & Time</label><input type="datetime-local" id="incidentTime" required></div>
                    <div>
                        <label>Classification</label>
                        <select id="incidentType">
                            <option>Structuring (Cash Threshold)</option>
                            <option>Money Laundering Suspicion</option>
                            <option>False Identification</option>
                            <option>Loan Sharking / Collusion</option>
                            <option>General Suspicious Activity</option>
                        </select>
                    </div>
                </div>
                <div style="margin-bottom: 15px;">
                    <label>Narrative</label>
                    <textarea id="narrative" rows="5" placeholder="Detailed chronological account..."></textarea>
                </div>
            </div>

            <div class="card">
                <h2>Additional Data</h2>
                <div class="form-grid" style="grid-template-columns: 1fr 1fr 1fr;">
                    <div><label>Asset No.</label><input type="text" id="assetNum"></div>
                    <div><label>Turnover ($)</label><input type="number" id="meterIn"></div>
                    <div><label>Win ($)</label><input type="number" id="meterOut"></div>
                </div>
                
                <div style="margin-top: 20px;">
                    <label>Associates (Separate by comma)</label>
                    <input type="text" id="assocInput" placeholder="e.g. John Doe, Jane Smith">
                </div>
            </div>

            <div style="display:flex; justify-content: flex-end;">
                <button type="submit" class="btn">Submit Report</button>
            </div>
        </form>
    </div>

    <div id="connections" class="section">
        <h1>Intelligence Search</h1>
        <div class="card" style="padding: 0; overflow: hidden;">
            <div style="padding: 24px; border-bottom: 1px solid var(--border); background: #f8fafc;">
                <div style="position: relative;">
                    <i class="fa-solid fa-magnifying-glass" style="position: absolute; left: 14px; top: 12px; color: var(--text-light);"></i>
                    <input type="text" id="searchInput" onkeyup="runSearch()" placeholder="Search by Name, Associate, ID, or Asset Number..." style="padding-left: 40px; font-size: 1rem;">
                </div>
            </div>
            <div id="searchResults">
                <div style="padding: 40px; text-align: center; color: var(--text-light);">
                    Start typing to search the database...
                </div>
            </div>
        </div>
    </div>
</main>

<script>
    // --- FAKE DATA GENERATOR (Runs on first load) ---
    function initDB() {
        let db = localStorage.getItem('bespoke_smr_db');
        if (!db || JSON.parse(db).length < 2) {
            const names = ["Sterling ARCHER", "Lana KANE", "Cyril FIGGIS", "Pam POOVEY", "Cheryl TUNT", "Algernon KRIEGER"];
            const types = ["Structuring (Cash Threshold)", "Money Laundering Suspicion", "False Identification"];
            let data = [];
            
            for(let i=0; i<20; i++) {
                let name = names[Math.floor(Math.random() * names.length)];
                data.push({
                    id: 1000 + i,
                    poiName: name,
                    time: new Date(Date.now() - Math.floor(Math.random() * 10000000000)).toISOString(),
                    type: types[Math.floor(Math.random() * types.length)],
                    narrative: `Subject ${name} observed engaging in activity inconsistent with recreational gaming. Multiple small transactions noted.`,
                    associates: (Math.random() > 0.6) ? ["Unknown Male"] : [],
                    asset: (Math.random() > 0.5) ? "GM-" + Math.floor(Math.random() * 500) : "",
                    turnover: Math.floor(Math.random() * 5000),
                    win: 0,
                    files: (Math.random() > 0.7) ? ["cctv_clip.mp4"] : []
                });
            }
            localStorage.setItem('bespoke_smr_db', JSON.stringify(data.sort((a,b) => new Date(b.time) - new Date(a.time))));
        }
        renderDashboard();
    }

    // --- APP STATE ---
    let reports = [];

    // --- NAVIGATION ---
    function showSection(id, btn) {
        document.querySelectorAll('.section').forEach(el => el.classList.remove('active'));
        document.querySelectorAll('.nav-item').forEach(el => el.classList.remove('active'));
        document.getElementById(id).classList.add('active');
        if(btn) btn.classList.add('active');
        if(id === 'dashboard') renderDashboard();
    }

    // --- DRAWER LOGIC ---
    function openDrawer(id) {
        const r = reports.find(i => i.id == id);
        if(!r) return;

        document.getElementById('d_name').innerText = r.poiName;
        document.getElementById('d_type').innerText = r.type;
        document.getElementById('d_time').innerText = new Date(r.time).toLocaleString();
        document.getElementById('d_narrative').innerText = r.narrative;
        
        // Associates
        const assocHTML = r.associates.length ? r.associates.map(a => `<span class="badge badge-gray">${a}</span>`).join('') : '<span style="color:#94a3b8; font-size:0.9rem;">None</span>';
        document.getElementById('d_associates').innerHTML = assocHTML;

        // Machine
        document.getElementById('d_machine').innerText = r.asset ? `Asset: ${r.asset} | TO: $${r.turnover} | Win: $${r.win}` : "No machine data.";

        // Files
        const filesHTML = r.files.length ? r.files.map(f => `<div class="file-attachment"><i class="fa-solid fa-file"></i> ${f}</div>`).join('') : '<span style="color:#94a3b8; font-size:0.9rem;">No files attached.</span>';
        document.getElementById('d_files').innerHTML = filesHTML;

        document.getElementById('overlay').classList.add('open');
        document.getElementById('drawer').classList.add('open');
    }

    function closeDrawer() {
        document.getElementById('overlay').classList.remove('open');
        document.getElementById('drawer').classList.remove('open');
    }

    // --- DASHBOARD ---
    function renderDashboard() {
        reports = JSON.parse(localStorage.getItem('bespoke_smr_db')) || [];
        
        // Stats
        document.getElementById('totalCount').innerText = reports.length;
        const unique = new Set(reports.map(r => r.poiName));
        document.getElementById('poiCount').innerText = unique.size;
        document.getElementById('alertCount').innerText = reports.filter(r => r.turnover > 3000).length;

        // Table
        let html = `<table>
            <thead><tr><th>Date</th><th>Subject</th><th>Classification</th><th>Status</th></tr></thead>
            <tbody>`;
        
        reports.slice(0, 15).forEach(r => {
            html += `
            <tr class="row-interactive" onclick="openDrawer(${r.id})">
                <td>${new Date(r.time).toLocaleDateString()}</td>
                <td><strong>${r.poiName}</strong></td>
                <td><span class="badge badge-gray">${r.type}</span></td>
                <td><span class="badge badge-blue">Submitted</span></td>
            </tr>`;
        });
        html += `</tbody></table>`;
        document.getElementById('table-wrapper').innerHTML = html;
    }

    // --- SUBMIT ---
    function submitReport(e) {
        e.preventDefault();
        const rawAssoc = document.getElementById('assocInput').value;
        const newEntry = {
            id: Date.now(),
            poiName: document.getElementById('poiName').value,
            poiId: document.getElementById('poiId').value,
            time: document.getElementById('incidentTime').value,
            type: document.getElementById('incidentType').value,
            narrative: document.getElementById('narrative').value,
            asset: document.getElementById('assetNum').value,
            turnover: document.getElementById('meterIn').value,
            win: document.getElementById('meterOut').value,
            associates: rawAssoc ? rawAssoc.split(',').map(s => s.trim()) : [],
            files: []
        };
        reports.unshift(newEntry);
        localStorage.setItem('bespoke_smr_db', JSON.stringify(reports));
        document.getElementById('smrForm').reset();
        alert("Report Submitted Successfully");
        showSection('dashboard', document.querySelectorAll('.nav-item')[0]);
    }

    // --- SEARCH ---
    function runSearch() {
        const q = document.getElementById('searchInput').value.toLowerCase();
        const res = document.getElementById('searchResults');
        if(q.length < 2) { res.innerHTML = `<div style="padding:40px; text-align:center; color:#94a3b8;">Type to search...</div>`; return; }

        const hits = reports.filter(r => r.poiName.toLowerCase().includes(q) || r.associates.some(a=>a.toLowerCase().includes(q)));
        
        if(hits.length === 0) { res.innerHTML = `<div style="padding:20px; text-align:center;">No results found.</div>`; return; }

        res.innerHTML = hits.map(h => `
            <div class="search-result" onclick="openDrawer(${h.id})">
                <div style="display:flex; justify-content:space-between; margin-bottom:4px;">
                    <strong>${h.poiName}</strong>
                    <span style="font-size:0.8rem; color:var(--text-light);">${new Date(h.time).toLocaleDateString()}</span>
                </div>
                <div style="font-size:0.9rem; color:var(--text-main); margin-bottom:4px;">${h.type}</div>
                <div style="font-size:0.85rem; color:var(--text-light); white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">${h.narrative}</div>
            </div>
        `).join('');
    }

    // Init
    initDB();

</script>
</body>
</html>
