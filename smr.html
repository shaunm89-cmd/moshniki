<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Moshniki's ECDD Report Builder</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { background: #0f172a; color: #f8fafc; height: 100vh; display: flex; overflow: hidden; }
        #source-list { width: 300px; background: #1e293b; border-right: 1px solid #334155; padding: 20px; overflow-y: auto; }
        #viewer-area { flex-grow: 1; display: flex; flex-direction: column; background: #000; }
        #report-sidebar { width: 350px; background: #1e293b; border-left: 1px solid #334155; padding: 20px; overflow-y: auto; }
        iframe { width: 100%; height: 100%; border: none; background: white; }
        .module-btn { width: 100%; margin-bottom: 8px; text-align: left; font-size: 0.85rem; }
        .report-item { background: #334155; padding: 10px; border-radius: 5px; margin-bottom: 10px; font-size: 0.8rem; border-left: 3px solid #3b82f6; }
        .btn-add { float: right; padding: 0px 5px; font-size: 0.7rem; }
    </style>
</head>
<body>

    <div id="source-list">
        <h6 class="text-uppercase fw-bold text-muted small mb-3">Target Name</h6>
        <input type="text" id="target" class="form-control form-control-sm bg-dark text-white border-secondary mb-3" placeholder="Enter Name...">
        
        <h6 class="text-uppercase fw-bold text-muted small mb-2">1. Registry Check</h6>
        <button class="btn btn-outline-info module-btn" onclick="load('abr')">ABN Lookup (GOV)</button>
        <button class="btn btn-outline-info module-btn" onclick="load('asic')">ASIC Search</button>
        
        <h6 class="text-uppercase fw-bold text-muted small mt-3 mb-2">2. Compliance (PEP)</h6>
        <button class="btn btn-outline-danger module-btn" onclick="load('os')">OpenSanctions (World)</button>
        <button class="btn btn-outline-danger module-btn" onclick="load('dfat')">DFAT Sanctions (AU)</button>
        
        <h6 class="text-uppercase fw-bold text-muted small mt-3 mb-2">3. Judicial & Gov</h6>
        <button class="btn btn-outline-success module-btn" onclick="load('judges')">Federal Court Judges</button>
        <button class="btn btn-outline-success module-btn" onclick="load('dir')">AU Gov Directory</button>
    </div>

    <div id="viewer-area">
        <div class="bg-dark p-2 d-flex justify-content-between">
            <span id="current-site" class="small text-info mt-1">Select a module</span>
            <button class="btn btn-sm btn-primary" onclick="addToReport()">+ Add Current Page to Report</button>
        </div>
        <iframe id="browser" src="about:blank"></iframe>
    </div>

    <div id="report-sidebar">
        <h5 class="fw-bold mb-3">Draft Report</h5>
        <div id="report-content">
            <p class="text-muted small">No data collected yet. Use the "Add" button to pull info here.</p>
        </div>
        <hr class="border-secondary">
        <button class="btn btn-warning w-100 fw-bold" onclick="printReport()">Download PDF Report</button>
    </div>

    <script>
        const sources = {
            abr: n => `https://abr.business.gov.au/Search/Results?SearchText=${n}`,
            asic: n => `https://www.google.com/search?q=site:asic.gov.au+"${n}"`,
            os: n => `https://www.opensanctions.org/search/?q=${n}`,
            dfat: n => `https://www.google.com/search?q=site:dfat.gov.au+"${n}"+consolidated+list`,
            judges: n => `https://www.google.com/search?q=site:fedcourt.gov.au+"${n}"`,
            dir: n => `https://www.directory.gov.au/search?keywords=${n}`
        };

        let currentKey = "";

        function load(key) {
            const name = document.getElementById('target').value;
            if(!name) return alert("Enter name first");
            currentKey = key;
            document.getElementById('browser').src = sources[key](encodeURIComponent(name));
            document.getElementById('current-site').innerText = "Module: " + key.toUpperCase();
        }

        function addToReport() {
            const container = document.getElementById('report-content');
            if (container.innerText.includes("No data")) container.innerHTML = "";
            
            const time = new Date().toLocaleTimeString();
            const div = document.createElement('div');
            div.className = "report-item";
            div.innerHTML = `<strong>${currentKey.toUpperCase()} Check</strong> at ${time}<br>
                             Verified data on the current target. <br>
                             <textarea class="form-control form-control-sm mt-1 bg-dark text-white border-0" placeholder="Add specific notes here..."></textarea>`;
            container.appendChild(div);
        }

        function printReport() {
            const name = document.getElementById('target').value || "Unnamed_Target";
            const content = document.getElementById('report-sidebar').innerHTML;
            const win = window.open('', '', 'height=700,width=900');
            win.document.write(`<html><head><title>ECDD Report - ${name}</title>`);
            win.document.write('<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">');
            win.document.write('</head><body class="p-5">');
            win.document.write(`<h1>Intelligence Report: ${name}</h1><hr>`);
            win.document.write(document.getElementById('report-content').innerHTML);
            win.document.write('</body></html>');
            win.document.close();
            win.print();
        }
    </script>
</body>
</html>
