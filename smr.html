<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SMR INTELLIGENCE TERMINAL // V.4.1</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        :root {
            --bg-deep: #050b14;
            --bg-panel: rgba(16, 23, 42, 0.85);
            --border-color: rgba(56, 189, 248, 0.3);
            --text-main: #e2e8f0;
            --text-muted: #94a3b8;
            --accent-cyan: #06b6d4;
            --accent-glow: rgba(6, 182, 212, 0.5);
            --danger: #ef4444;
            --font-ui: 'Inter', sans-serif;
            --font-code: 'JetBrains Mono', monospace;
        }

        body {
            margin: 0;
            font-family: var(--font-ui);
            background-color: var(--bg-deep);
            color: var(--text-main);
            height: 100vh;
            display: flex;
            overflow: hidden;
            background-image: 
                linear-gradient(rgba(6, 182, 212, 0.05) 1px, transparent 1px),
                linear-gradient(90deg, rgba(6, 182, 212, 0.05) 1px, transparent 1px);
            background-size: 40px 40px;
            animation: bgScroll 60s linear infinite;
        }

        @keyframes bgScroll { from { background-position: 0 0; } to { background-position: 40px 40px; } }

        /* SCROLLBAR */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: var(--bg-deep); }
        ::-webkit-scrollbar-thumb { background: var(--border-color); border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: var(--accent-cyan); }

        /* --- SIDEBAR --- */
        aside {
            width: 280px;
            background: rgba(5, 11, 20, 0.95);
            border-right: 1px solid var(--border-color);
            display: flex;
            flex-direction: column;
            backdrop-filter: blur(10px);
            z-index: 10;
        }

        .brand {
            padding: 30px;
            font-family: var(--font-code);
            font-size: 1.2rem;
            color: var(--accent-cyan);
            text-shadow: 0 0 10px var(--accent-glow);
            border-bottom: 1px solid var(--border-color);
        }

        .nav-btn {
            background: transparent; border: none; color: var(--text-muted); padding: 18px 25px;
            text-align: left; cursor: pointer; font-family: var(--font-code); font-size: 0.9rem;
            transition: 0.3s; display: flex; align-items: center; gap: 15px; border-left: 3px solid transparent;
        }

        .nav-btn:hover { background: rgba(6, 182, 212, 0.1); color: white; }
        .nav-btn.active { 
            background: linear-gradient(90deg, rgba(6,182,212,0.15), transparent); 
            color: var(--accent-cyan); border-left: 3px solid var(--accent-cyan);
        }

        /* --- MAIN CONTENT --- */
        main { flex: 1; padding: 40px; overflow-y: auto; position: relative; }
        
        main::before {
            content: " "; display: block; position: absolute; top: 0; left: 0; bottom: 0; right: 0;
            background: linear-gradient(rgba(18, 16, 16, 0) 50%, rgba(0, 0, 0, 0.1) 50%);
            background-size: 100% 4px; pointer-events: none; z-index: 2;
        }

        h1 { font-family: var(--font-code); color: white; margin-top: 0; border-bottom: 2px solid var(--border-color); display: inline-block; padding-bottom: 10px; }

        .glass-panel {
            background: var(--bg-panel); border: 1px solid var(--border-color); border-radius: 4px;
            padding: 25px; margin-bottom: 25px; backdrop-filter: blur(5px);
            box-shadow: 0 4px 30px rgba(0, 0, 0, 0.5); position: relative;
        }

        /* --- HUD --- */
        .hud-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; margin-bottom: 30px; }
        .hud-card {
            background: rgba(6, 182, 212, 0.05); border: 1px solid var(--border-color);
            padding: 20px; display: flex; align-items: center; gap: 20px;
        }
        .hud-val { font-family: var(--font-code); font-size: 2.5rem; color: var(--accent-cyan); text-shadow: 0 0 15px var(--accent-glow); }

        /* --- FORMS --- */
        .form-row { display: flex; gap: 20px; margin-bottom: 15px; }
        input, select, textarea {
            width: 100%; background: rgba(0,0,0,0.3); border: 1px solid var(--border-color);
            color: white; padding: 12px; font-family: var(--font-code); font-size: 0.9rem; box-sizing: border-box;
        }
        input:focus { outline: none; border-color: var(--accent-cyan); box-shadow: 0 0 10px var(--accent-glow); }
        label { color: var(--accent-cyan); font-size: 0.75rem; text-transform: uppercase; display: block; margin-bottom: 5px; }

        .cyber-btn {
            background: var(--accent-cyan); color: #000; border: none; padding: 12px 24px;
            font-family: var(--font-code); font-weight: bold; cursor: pointer; transition: 0.3s;
        }
        .cyber-btn:hover { background: white; box-shadow: 0 0 20px var(--accent-cyan); }

        /* --- TABLE --- */
        .data-table { width: 100%; border-collapse: collapse; font-family: var(--font-code); font-size: 0.85rem; }
        .data-table th { text-align: left; padding: 15px; color: var(--accent-cyan); border-bottom: 1px solid var(--border-color); }
        .data-table td { padding: 15px; border-bottom: 1px solid rgba(255,255,255,0.05); }
        
        /* CLICKABLE ROWS */
        .clickable-row { cursor: pointer; transition: all 0.2s; }
        .clickable-row:hover { background: rgba(6, 182, 212, 0.15); border-left: 2px solid var(--accent-cyan); }

        /* --- MODAL (POPUP) --- */
        .modal-overlay {
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.8); z-index: 100; backdrop-filter: blur(5px);
            justify-content: center; align-items: center;
        }
        .modal-overlay.active { display: flex; animation: fadeIn 0.3s; }
        
        .modal-content {
            background: #0f172a; border: 1px solid var(--accent-cyan); width: 60%; max-height: 90vh;
            overflow-y: auto; padding: 0; box-shadow: 0 0 50px rgba(6, 182, 212, 0.2);
            position: relative; display: flex; flex-direction: column;
        }

        .modal-header {
            background: rgba(6, 182, 212, 0.1); padding: 20px; border-bottom: 1px solid var(--border-color);
            display: flex; justify-content: space-between; align-items: center;
        }
        .modal-body { padding: 30px; font-family: var(--font-code); line-height: 1.6; }
        
        .close-btn { background: none; border: none; color: var(--danger); font-size: 1.5rem; cursor: pointer; }
        .close-btn:hover { color: white; }

        .detail-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px; border-bottom: 1px dashed var(--border-color); padding-bottom: 20px; }
        .detail-label { color: var(--text-muted); font-size: 0.8rem; }
        .detail-value { font-size: 1.1rem; color: white; }

        /* Utility */
        .section { display: none; }
        .section.active { display: block; animation: flicker 0.5s; }
        .tag-node { display: inline-block; background: rgba(255,255,255,0.1); padding: 2px 8px; font-size: 0.75rem; margin-right: 5px; color: var(--accent-cyan); }
        .tag-alert { color: var(--danger); border: 1px solid var(--danger); background: rgba(239,68,68,0.1); }
        
        @keyframes flicker { 0% { opacity: 0; } 100% { opacity: 1; } }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

    </style>
</head>
<body>

<div id="reportModal" class="modal-overlay" onclick="closeModal(event)">
    <div class="modal-content" onclick="event.stopPropagation()"> <div class="modal-header">
            <div>
                <div style="font-size: 0.8rem; color: var(--accent-cyan);">CLASSIFIED DOSSIER</div>
                <h2 id="m_poiName" style="margin:0; font-family:var(--font-code);">TARGET NAME</h2>
            </div>
            <button class="close-btn" onclick="closeModal(null)"><i class="fa-solid fa-xmark"></i></button>
        </div>
        <div class="modal-body">
            <div class="detail-grid">
                <div>
                    <div class="detail-label">INCIDENT TYPE</div>
                    <div class="detail-value" id="m_type" style="color:var(--accent-cyan)">Suspicious Activity</div>
                </div>
                <div>
                    <div class="detail-label">TIMESTAMP</div>
                    <div class="detail-value" id="m_time">2023-01-01</div>
                </div>
                <div>
                    <div class="detail-label">IDENTIFIER</div>
                    <div class="detail-value" id="m_id">--</div>
                </div>
                <div>
                    <div class="detail-label">REPORT ID</div>
                    <div class="detail-value" id="m_reportId">#0000</div>
                </div>
            </div>

            <div style="margin-bottom:20px;">
                <div class="detail-label">NARRATIVE / OBSERVATION</div>
                <div id="m_narrative" style="background:rgba(0,0,0,0.3); padding:15px; border-left:3px solid var(--accent-cyan); color:#e2e8f0; margin-top:5px;">
                    Loading...
                </div>
            </div>

            <div style="display:grid; grid-template-columns: 1fr 1fr; gap:20px;">
                <div>
                    <div class="detail-label" style="margin-bottom:10px;">CONNECTED ENTITIES</div>
                    <div id="m_associates"></div>
                </div>
                <div>
                    <div class="detail-label" style="margin-bottom:10px;">MACHINE TELEMETRY</div>
                    <div id="m_machine" style="font-size:0.9rem; color:var(--text-muted);">No Machine Data</div>
                </div>
            </div>

            <div style="margin-top:20px; border-top:1px dashed var(--border-color); padding-top:20px;">
                <div class="detail-label">ATTACHED EVIDENCE</div>
                <div id="m_files" style="display:flex; gap:10px; flex-wrap:wrap; margin-top:10px;"></div>
            </div>
        </div>
        <div style="padding:15px; background:rgba(0,0,0,0.2); text-align:right;">
            <button class="cyber-btn" onclick="closeModal(null)" style="font-size:0.8rem; padding:8px 16px;">CLOSE DOSSIER</button>
        </div>
    </div>
</div>

<aside>
    <div class="brand"><i class="fa-solid fa-eye"></i> OMNI-INTEL</div>
    <div style="flex:1;">
        <button class="nav-btn active" onclick="showSection('dashboard', this)">
            <i class="fa-solid fa-chart-line"></i> LIVE_FEED
        </button>
        <button class="nav-btn" onclick="showSection('new-report', this)">
            <i class="fa-solid fa-file-code"></i> INPUT_DATA
        </button>
        <button class="nav-btn" onclick="showSection('connections', this)">
            <i class="fa-solid fa-network-wired"></i> LINK_ANALYSIS
        </button>
    </div>
    <div style="padding:20px; font-size:0.75rem; color:var(--text-muted); font-family:var(--font-code);">
        USER: SUP_SHAUN<br>CLEARANCE: LEVEL 4
    </div>
</aside>

<main>
    <div id="dashboard" class="section active">
        <h1>SYSTEM STATUS: ONLINE</h1>
        
        <div class="hud-grid">
            <div class="hud-card">
                <i class="fa-solid fa-database fa-2x" style="color:var(--text-muted)"></i>
                <div><div class="hud-val" id="totalCount">0</div><div style="color:var(--text-muted)">Total Records</div></div>
            </div>
            <div class="hud-card">
                <i class="fa-solid fa-users-viewfinder fa-2x" style="color:var(--text-muted)"></i>
                <div><div class="hud-val" id="associateCount">0</div><div style="color:var(--text-muted)">Entities Tracked</div></div>
            </div>
            <div class="hud-card" style="border-color: var(--danger);">
                <i class="fa-solid fa-triangle-exclamation fa-2x" style="color:var(--danger)"></i>
                <div><div class="hud-val" id="alertCount" style="color:var(--danger)">0</div><div style="color:var(--danger)">Priority Alerts</div></div>
            </div>
        </div>

        <div class="glass-panel">
            <h2 style="font-size: 1rem; color: var(--accent-cyan); margin-bottom: 20px;">>> RECENT_INTERCEPTS (CLICK TO VIEW)</h2>
            <div id="table-container"></div>
        </div>
    </div>

    <div id="new-report" class="section">
        <h1>>> INITIATE_PROTOCOL: NEW_ENTRY</h1>
        <form id="smrForm" onsubmit="submitReport(event)">
            <div class="glass-panel">
                <div class="form-row">
                    <div style="flex:1"><label>TARGET_NAME</label><input type="text" id="poiName" required></div>
                    <div style="flex:1"><label>ID</label><input type="text" id="poiId"></div>
                </div>
                <div class="form-row">
                    <div style="flex:1"><label>TIMESTAMP</label><input type="datetime-local" id="incidentTime" required></div>
                    <div style="flex:1">
                        <label>CLASSIFICATION</label>
                        <select id="incidentType">
                            <option>STRUCTURING_CASH</option>
                            <option>MONEY_LAUNDERING_SUSPICION</option>
                            <option>FALSE_IDENTITY</option>
                            <option>SYNDICATE_ACTIVITY</option>
                        </select>
                    </div>
                </div>
                <label>NARRATIVE</label>
                <textarea id="narrative" rows="4"></textarea>
            </div>
            
            <div class="glass-panel">
                 <div class="form-row">
                    <div style="flex:1"><label>MACHINE NO</label><input type="text" id="assetNum"></div>
                    <div style="flex:1"><label>TURNOVER</label><input type="number" id="meterIn"></div>
                    <div style="flex:1"><label>PAYOUT</label><input type="number" id="meterOut"></div>
                </div>
                <label>ASSOCIATES</label>
                <div style="display:flex; gap:10px; margin-bottom:10px;">
                    <input type="text" id="assocInput"><button type="button" class="cyber-btn" onclick="addAssociate()">LINK</button>
                </div>
                <div id="assocTags"></div>
            </div>
            <button type="submit" class="cyber-btn" style="width:100%">ENCRYPT & SUBMIT</button>
        </form>
    </div>

    <div id="connections" class="section">
        <h1>>> GLOBAL_SEARCH</h1>
        <div class="glass-panel" style="display:flex; gap:15px; align-items: center;">
            <i class="fa-solid fa-magnifying-glass" style="color:var(--accent-cyan)"></i>
            <input type="text" id="searchInput" placeholder="SEARCH QUERY..." onkeyup="runSearch()" style="border:none; background:transparent; font-size:1.2rem; color:white; width:100%;">
        </div>
        <div id="searchResults"></div>
    </div>
</main>

<script>
    // --- DEMO DATA GENERATOR ---
    function initSystem() {
        let existing = localStorage.getItem('omni_intel_db_v4');
        if (!existing || JSON.parse(existing).length < 2) {
            const demoData = generateFakeData();
            localStorage.setItem('omni_intel_db_v4', JSON.stringify(demoData));
        }
        renderDashboard();
    }

    function generateFakeData() {
        const poiPool = ["KOVACS, Viktor", "SANTOS, Maria", "CHEN, Wei", "O'MALLEY, Sean", "IVANOV, Dmitri"];
        const assocPool = ["The Driver", "Tall Guy", "Blonde Female", "Mr. Red Hat"];
        let data = [];
        for (let i = 0; i < 20; i++) {
            let poi = (i % 3 === 0) ? "KOVACS, Viktor" : poiPool[Math.floor(Math.random() * poiPool.length)];
            let assocs = [];
            if(Math.random() > 0.5) assocs.push(assocPool[Math.floor(Math.random() * assocPool.length)]);
            
            data.push({
                id: 1000 + i,
                poiName: poi,
                poiId: "ID-" + Math.floor(Math.random() * 90000),
                time: new Date(Date.now() - Math.floor(Math.random() * 10000000000)).toISOString(),
                type: "STRUCTURING_CASH",
                narrative: "Subject observed rapidly feeding notes into EGM. No play recorded.",
                associates: assocs,
                asset: "GM-" + Math.floor(Math.random() * 500),
                turnover: Math.floor(Math.random() * 5000), win: 0,
                files: ["cam04.mp4"]
            });
        }
        return data.sort((a,b) => new Date(b.time) - new Date(a.time));
    }

    // --- APP LOGIC ---
    let reports = [];
    let tempAssocs = [];

    function showSection(id, btn) {
        document.querySelectorAll('.section').forEach(el => el.classList.remove('active'));
        document.querySelectorAll('.nav-btn').forEach(el => el.classList.remove('active'));
        document.getElementById(id).classList.add('active');
        if(btn) btn.classList.add('active');
        if(id === 'dashboard') renderDashboard();
    }

    // --- MODAL LOGIC ---
    function openReport(id) {
        const r = reports.find(item => item.id == id);
        if(!r) return;

        // Fill Data
        document.getElementById('m_poiName').innerText = r.poiName;
        document.getElementById('m_type').innerText = r.type;
        document.getElementById('m_time').innerText = new Date(r.time).toLocaleString();
        document.getElementById('m_id').innerText = r.poiId || "Unknown";
        document.getElementById('m_reportId').innerText = "#" + r.id;
        document.getElementById('m_narrative').innerText = r.narrative;
        
        // Associates
        const assocDiv = document.getElementById('m_associates');
        assocDiv.innerHTML = r.associates.length > 0 
            ? r.associates.map(a => `<span class="tag-node">${a}</span>`).join('') 
            : '<span style="color:gray">// None</span>';

        // Machine
        const machineDiv = document.getElementById('m_machine');
        if(r.asset) {
            machineDiv.innerHTML = `
                <div style="background:rgba(255,255,255,0.05); padding:10px;">
                    <strong>ASSET:</strong> ${r.asset}<br>
                    <strong>TURNOVER:</strong> $${r.turnover}<br>
                    <strong>WIN:</strong> $${r.win}
                </div>`;
        } else { machineDiv.innerText = "No Machine Data"; }

        // Files
        const fileDiv = document.getElementById('m_files');
        fileDiv.innerHTML = (r.files && r.files.length > 0)
            ? r.files.map(f => `<div class="tag-node" style="border:1px solid var(--accent-cyan)"><i class="fa-solid fa-file"></i> ${f}</div>`).join('')
            : '<span style="color:gray">// No Attachments</span>';

        // Show
        document.getElementById('reportModal').classList.add('active');
    }

    function closeModal(e) {
        if(e === null || e.target.id === 'reportModal') {
            document.getElementById('reportModal').classList.remove('active');
        }
    }

    // --- DASHBOARD ---
    function renderDashboard() {
        reports = JSON.parse(localStorage.getItem('omni_intel_db_v4')) || [];
        document.getElementById('totalCount').innerText = reports.length;

        const container = document.getElementById('table-container');
        let html = `<table class="data-table">
            <thead><tr><th>TIMESTAMP</th><th>TARGET</th><th>CLASSIFICATION</th><th>ASSET</th></tr></thead>
            <tbody>`;
        
        reports.slice(0, 15).forEach(r => {
            html += `
            <tr class="clickable-row" onclick="openReport(${r.id})">
                <td style="color:var(--text-muted)">${r.time.slice(0,10)}</td>
                <td style="font-weight:bold; color:#fff;">${r.poiName}</td>
                <td><span class="tag-node ${r.type.includes('SYNDICATE') ? 'tag-alert' : ''}">${r.type}</span></td>
                <td style="font-family:monospace">${r.asset || '--'}</td>
            </tr>`;
        });
        html += `</tbody></table>`;
        container.innerHTML = html;
    }

    // --- SUBMIT ---
    function addAssociate() {
        const val = document.getElementById('assocInput').value.trim();
        if(val) { tempAssocs.push(val); document.getElementById('assocInput').value = ""; renderTags(); }
    }
    function renderTags() {
        document.getElementById('assocTags').innerHTML = tempAssocs.map(a => `<span class="tag-node">${a}</span>`).join(' ');
    }
    function submitReport(e) {
        e.preventDefault();
        const newEntry = {
            id: Date.now(),
            poiName: document.getElementById('poiName').value,
            poiId: document.getElementById('poiId').value,
            time: document.getElementById('incidentTime').value,
            type: document.getElementById('incidentType').value,
            narrative: document.getElementById('narrative').value,
            asset: document.getElementById('assetNum').value,
            turnover: document.getElementById('meterIn').value,
            win: document.getElementById('meterOut').value,
            associates: [...tempAssocs],
            files: []
        };
        reports.unshift(newEntry);
        localStorage.setItem('omni_intel_db_v4', JSON.stringify(reports));
        document.getElementById('smrForm').reset(); tempAssocs=[]; renderTags();
        alert("ENTRY ENCRYPTED."); showSection('dashboard');
    }

    // --- SEARCH ---
    function runSearch() {
        const q = document.getElementById('searchInput').value.toLowerCase();
        const res = document.getElementById('searchResults');
        if(q.length < 2) { res.innerHTML=""; return; }

        const hits = reports.filter(r => r.poiName.toLowerCase().includes(q) || r.associates.some(a=>a.toLowerCase().includes(q)));
        
        res.innerHTML = hits.map(h => `
            <div class="glass-panel clickable-row" onclick="openReport(${h.id})" style="cursor:pointer">
                <div style="font-size:1.1rem; margin-bottom:5px; font-weight:bold; color:white;">${h.poiName} <span style="font-weight:normal; font-size:0.8rem; color:var(--text-muted)">(${h.type})</span></div>
                <div style="color:var(--text-muted); font-style:italic;">"${h.narrative.substring(0, 100)}..."</div>
            </div>
        `).join('');
    }

    initSystem();
</script>
</body>
</html>
