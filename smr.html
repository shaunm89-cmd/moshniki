<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SMR INTELLIGENCE TERMINAL // V.4.0</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        :root {
            --bg-deep: #050b14;
            --bg-panel: rgba(16, 23, 42, 0.7); /* Glass effect */
            --border-color: rgba(56, 189, 248, 0.2);
            --text-main: #e2e8f0;
            --text-muted: #94a3b8;
            --accent-cyan: #06b6d4;
            --accent-glow: rgba(6, 182, 212, 0.4);
            --danger: #ef4444;
            --success: #10b981;
            --font-ui: 'Inter', sans-serif;
            --font-code: 'JetBrains Mono', monospace;
        }

        body {
            margin: 0;
            font-family: var(--font-ui);
            background-color: var(--bg-deep);
            color: var(--text-main);
            height: 100vh;
            display: flex;
            overflow: hidden;
            /* Cool Animated Background */
            background-image: 
                linear-gradient(rgba(6, 182, 212, 0.05) 1px, transparent 1px),
                linear-gradient(90deg, rgba(6, 182, 212, 0.05) 1px, transparent 1px);
            background-size: 40px 40px;
            animation: bgScroll 60s linear infinite;
        }

        @keyframes bgScroll {
            from { background-position: 0 0; }
            to { background-position: 40px 40px; }
        }

        /* --- SIDEBAR --- */
        aside {
            width: 280px;
            background: rgba(5, 11, 20, 0.95);
            border-right: 1px solid var(--border-color);
            display: flex;
            flex-direction: column;
            backdrop-filter: blur(10px);
            z-index: 10;
        }

        .brand {
            padding: 30px;
            font-family: var(--font-code);
            font-size: 1.2rem;
            color: var(--accent-cyan);
            text-shadow: 0 0 10px var(--accent-glow);
            letter-spacing: 2px;
            border-bottom: 1px solid var(--border-color);
        }

        .nav-btn {
            background: transparent;
            border: none;
            color: var(--text-muted);
            padding: 18px 25px;
            text-align: left;
            cursor: pointer;
            font-family: var(--font-code);
            font-size: 0.9rem;
            transition: 0.3s;
            display: flex;
            align-items: center;
            gap: 15px;
            border-left: 3px solid transparent;
        }

        .nav-btn:hover { background: rgba(6, 182, 212, 0.1); color: white; }
        .nav-btn.active { 
            background: linear-gradient(90deg, rgba(6,182,212,0.15), transparent); 
            color: var(--accent-cyan); 
            border-left: 3px solid var(--accent-cyan);
        }

        /* --- MAIN CONTENT --- */
        main {
            flex: 1;
            padding: 40px;
            overflow-y: auto;
            position: relative;
        }

        /* Scanline Overlay */
        main::before {
            content: " ";
            display: block;
            position: absolute;
            top: 0; left: 0; bottom: 0; right: 0;
            background: linear-gradient(rgba(18, 16, 16, 0) 50%, rgba(0, 0, 0, 0.1) 50%);
            background-size: 100% 4px;
            pointer-events: none;
            z-index: 2;
        }

        h1, h2 { font-family: var(--font-code); text-transform: uppercase; letter-spacing: 1px; }
        h1 { color: white; margin-top: 0; border-bottom: 2px solid var(--border-color); display: inline-block; padding-bottom: 10px; }

        /* --- CARDS & PANELS --- */
        .glass-panel {
            background: var(--bg-panel);
            border: 1px solid var(--border-color);
            border-radius: 4px;
            padding: 25px;
            margin-bottom: 25px;
            backdrop-filter: blur(5px);
            box-shadow: 0 4px 30px rgba(0, 0, 0, 0.5);
            position: relative;
        }
        
        .glass-panel::after {
            /* Decorative corner accent */
            content: ''; position: absolute; top: -1px; left: -1px; width: 20px; height: 20px;
            border-top: 2px solid var(--accent-cyan); border-left: 2px solid var(--accent-cyan);
        }

        /* --- STATS HUD --- */
        .hud-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; margin-bottom: 30px; }
        .hud-card {
            background: rgba(6, 182, 212, 0.05);
            border: 1px solid var(--border-color);
            padding: 20px;
            display: flex;
            align-items: center;
            gap: 20px;
        }
        .hud-val { font-family: var(--font-code); font-size: 2.5rem; color: var(--accent-cyan); text-shadow: 0 0 15px var(--accent-glow); }
        .hud-label { font-size: 0.8rem; color: var(--text-muted); text-transform: uppercase; }

        /* --- FORMS --- */
        .form-row { display: flex; gap: 20px; margin-bottom: 15px; }
        input, select, textarea {
            width: 100%;
            background: rgba(0,0,0,0.3);
            border: 1px solid var(--border-color);
            color: white;
            padding: 12px;
            font-family: var(--font-code);
            font-size: 0.9rem;
            box-sizing: border-box;
        }
        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: var(--accent-cyan);
            box-shadow: 0 0 10px var(--accent-glow);
        }
        label { color: var(--accent-cyan); font-size: 0.75rem; text-transform: uppercase; display: block; margin-bottom: 5px; letter-spacing: 1px; }

        /* --- BUTTONS --- */
        .cyber-btn {
            background: var(--accent-cyan);
            color: #000;
            border: none;
            padding: 12px 24px;
            font-family: var(--font-code);
            font-weight: bold;
            text-transform: uppercase;
            cursor: pointer;
            letter-spacing: 1px;
            transition: 0.3s;
        }
        .cyber-btn:hover { background: white; box-shadow: 0 0 20px var(--accent-cyan); }
        
        .upload-area {
            border: 1px dashed var(--border-color);
            padding: 20px;
            text-align: center;
            color: var(--text-muted);
            transition: 0.3s;
        }
        .upload-area:hover { border-color: var(--accent-cyan); background: rgba(6, 182, 212, 0.05); }

        /* --- TABLE & LISTS --- */
        .data-table { width: 100%; border-collapse: collapse; font-family: var(--font-code); font-size: 0.85rem; }
        .data-table th { text-align: left; padding: 15px; color: var(--accent-cyan); border-bottom: 1px solid var(--border-color); }
        .data-table td { padding: 15px; border-bottom: 1px solid rgba(255,255,255,0.05); }
        .data-table tr:hover { background: rgba(255,255,255,0.02); }

        /* --- INTEL CARDS (Search Results) --- */
        .intel-result {
            border-left: 3px solid var(--accent-cyan);
            background: linear-gradient(90deg, rgba(6,182,212,0.05), transparent);
            margin-bottom: 15px;
            padding: 15px;
        }
        .tag-node {
            display: inline-block;
            background: rgba(255,255,255,0.1);
            padding: 2px 8px;
            border-radius: 2px;
            font-size: 0.75rem;
            margin-right: 5px;
            color: var(--accent-cyan);
        }
        .tag-alert { color: var(--danger); border: 1px solid var(--danger); background: rgba(239,68,68,0.1); }

        /* Utility */
        .section { display: none; }
        .section.active { display: block; animation: flicker 0.5s; }
        @keyframes flicker {
            0% { opacity: 0; }
            50% { opacity: 0.8; }
            100% { opacity: 1; }
        }

    </style>
</head>
<body>

<aside>
    <div class="brand">
        <i class="fa-solid fa-eye"></i> OMNI-INTEL
    </div>
    <div style="flex:1;">
        <button class="nav-btn active" onclick="showSection('dashboard', this)">
            <i class="fa-solid fa-chart-line"></i> LIVE_FEED
        </button>
        <button class="nav-btn" onclick="showSection('new-report', this)">
            <i class="fa-solid fa-file-code"></i> INPUT_DATA
        </button>
        <button class="nav-btn" onclick="showSection('connections', this)">
            <i class="fa-solid fa-network-wired"></i> LINK_ANALYSIS
        </button>
    </div>
    <div style="padding: 20px; font-size: 0.75rem; color: var(--text-muted); font-family: var(--font-code);">
        USER: SUP_SHAUN<br>
        CLEARANCE: LEVEL 4<br>
        NODE: PENRITH_OPS
    </div>
</aside>

<main>
    <div id="dashboard" class="section active">
        <h1>SYSTEM STATUS: ONLINE</h1>
        
        <div class="hud-grid">
            <div class="hud-card">
                <i class="fa-solid fa-database fa-2x" style="color:var(--text-muted)"></i>
                <div>
                    <div class="hud-val" id="totalCount">0</div>
                    <div class="hud-label">Total Records</div>
                </div>
            </div>
            <div class="hud-card">
                <i class="fa-solid fa-users-viewfinder fa-2x" style="color:var(--text-muted)"></i>
                <div>
                    <div class="hud-val" id="associateCount">0</div>
                    <div class="hud-label">Entities Tracked</div>
                </div>
            </div>
            <div class="hud-card" style="border-color: var(--danger);">
                <i class="fa-solid fa-triangle-exclamation fa-2x" style="color:var(--danger)"></i>
                <div>
                    <div class="hud-val" id="alertCount" style="color: var(--danger)">0</div>
                    <div class="hud-label" style="color: var(--danger)">Priority Alerts</div>
                </div>
            </div>
        </div>

        <div class="glass-panel">
            <h2 style="font-size: 1rem; color: var(--accent-cyan); margin-bottom: 20px;">>> RECENT_INTERCEPTS</h2>
            <div id="table-container"></div>
        </div>
    </div>

    <div id="new-report" class="section">
        <h1>>> INITIATE_PROTOCOL: NEW_ENTRY</h1>
        
        <form id="smrForm" onsubmit="submitReport(event)">
            <div class="glass-panel">
                <div class="form-row">
                    <div style="flex:1">
                        <label>TARGET_NAME (POI)</label>
                        <input type="text" id="poiName" required placeholder="LASTNAME, Firstname">
                    </div>
                    <div style="flex:1">
                        <label>IDENTIFIER</label>
                        <input type="text" id="poiId" placeholder="MEMBER_ID / DL / P.PORT">
                    </div>
                </div>
                <div class="form-row">
                    <div style="flex:1">
                        <label>TIMESTAMP</label>
                        <input type="datetime-local" id="incidentTime" required>
                    </div>
                    <div style="flex:1">
                        <label>CLASSIFICATION</label>
                        <select id="incidentType">
                            <option>STRUCTURING_CASH</option>
                            <option>MONEY_LAUNDERING_SUSPICION</option>
                            <option>FALSE_IDENTITY</option>
                            <option>LOAN_SHARKING</option>
                            <option>EXCLUSION_BREACH</option>
                            <option>SYNDICATE_ACTIVITY</option>
                        </select>
                    </div>
                </div>
            </div>

            <div class="glass-panel">
                <label>NARRATIVE / OBSERVATION LOG</label>
                <textarea id="narrative" rows="4" placeholder="ENTER SURVEILLANCE DETAILS..."></textarea>
                <br><br>
                
                <div class="form-row">
                    <div style="flex:1">
                        <label>MACHINE_ASSET_NO</label>
                        <input type="text" id="assetNum" placeholder="GM-XXXX">
                    </div>
                    <div style="flex:1">
                        <label>TURNOVER ($)</label>
                        <input type="number" id="meterIn">
                    </div>
                    <div style="flex:1">
                        <label>PAYOUT ($)</label>
                        <input type="number" id="meterOut">
                    </div>
                </div>

                <label>EVIDENCE_UPLOAD</label>
                <div class="upload-area">
                    <i class="fa-solid fa-cloud-arrow-up fa-2x"></i><br>
                    DRAG_FILES // CLICK_TO_BROWSE
                    <input type="file" id="evidenceFiles" multiple onchange="handleFiles()" style="display:none;"> </div>
            </div>

            <div class="glass-panel">
                <label>ASSOCIATE_LINKING</label>
                <div style="display:flex; gap:10px;">
                    <input type="text" id="assocInput" placeholder="NAME OF ASSOCIATE">
                    <button type="button" class="cyber-btn" onclick="addAssociate()" style="padding: 10px;">LINK</button>
                </div>
                <div id="assocTags" style="margin-top:10px;"></div>
            </div>

            <button type="submit" class="cyber-btn" style="width:100%">SUBMIT TO DATABASE</button>
        </form>
    </div>

    <div id="connections" class="section">
        <h1>>> GLOBAL_SEARCH // LINK_ANALYSIS</h1>
        
        <div class="glass-panel" style="display:flex; gap:15px; align-items: center;">
            <i class="fa-solid fa-magnifying-glass" style="color:var(--accent-cyan)"></i>
            <input type="text" id="searchInput" placeholder="SEARCH QUERY: NAME, ID, OR KEYWORD..." onkeyup="runSearch()" style="border:none; background:transparent; font-size:1.2rem;">
        </div>

        <div id="searchResults"></div>
    </div>

</main>

<script>
    // --- DEMO DATA GENERATOR ---
    // If the system is empty, we inject a "Crime Syndicate" scenario
    function initSystem() {
        let existing = localStorage.getItem('omni_intel_db');
        
        if (!existing || JSON.parse(existing).length < 2) {
            console.log("INITIALIZING DEMO DATA...");
            const demoData = generateFakeData();
            localStorage.setItem('omni_intel_db', JSON.stringify(demoData));
        }
        
        renderDashboard();
    }

    function generateFakeData() {
        const poiPool = ["KOVACS, Viktor", "SANTOS, Maria", "CHEN, Wei", "O'MALLEY, Sean", "IVANOV, Dmitri"];
        const assocPool = ["The Driver", "Tall Guy", "Blonde Female", "Mr. Red Hat", "Unknown Male A", "Unknown Male B"];
        const types = ["STRUCTURING_CASH", "MONEY_LAUNDERING_SUSPICION", "SYNDICATE_ACTIVITY", "FALSE_IDENTITY"];
        const narratives = [
            "Subject observed feeding $50 notes into machine rapidly. No play, cashed out immediately.",
            "Met with associate in smoking area, exchanged small package.",
            "Attempted to use ID belonging to another person. Security intervened.",
            "Large volume of turnover observed. Meter readings inconsistent with visual play.",
            "Subject circling gaming floor, looking for credit left on machines."
        ];

        let data = [];
        // Create 20 Entries
        for (let i = 0; i < 20; i++) {
            // Pick random POI (Weighted towards Kovacs to make him a 'Kingpin')
            let poi = (i % 3 === 0) ? "KOVACS, Viktor" : poiPool[Math.floor(Math.random() * poiPool.length)];
            
            // Pick random Associates (1 to 3)
            let assocs = [];
            let numAssocs = Math.floor(Math.random() * 3);
            for(let j=0; j<numAssocs; j++) {
                assocs.push(assocPool[Math.floor(Math.random() * assocPool.length)]);
            }

            // Create Entry
            data.push({
                id: 1000 + i,
                poiName: poi,
                poiId: "ID-" + Math.floor(Math.random() * 90000 + 10000),
                time: new Date(Date.now() - Math.floor(Math.random() * 10000000000)).toISOString(),
                type: types[Math.floor(Math.random() * types.length)],
                narrative: narratives[Math.floor(Math.random() * narratives.length)],
                associates: assocs,
                asset: "GM-" + Math.floor(Math.random() * 500),
                turnover: Math.floor(Math.random() * 5000),
                win: Math.floor(Math.random() * 4000),
                files: (Math.random() > 0.5) ? ["cam04_footage.mp4", "meter_slip.jpg"] : []
            });
        }
        // Add a specific connection scenario
        data.push({
            id: 9999,
            poiName: "KOVACS, Viktor",
            poiId: "P-88212",
            time: new Date().toISOString(),
            type: "SYNDICATE_ACTIVITY",
            narrative: "Viktor met with Maria SANTOS and Wei CHEN. Distributed cash to both for structuring.",
            associates: ["SANTOS, Maria", "CHEN, Wei"],
            asset: "TABLE-04",
            turnover: 10000,
            win: 0,
            files: ["surveillance_log_final.pdf"]
        });

        return data.sort((a,b) => new Date(b.time) - new Date(a.time));
    }

    // --- APP LOGIC ---
    let reports = JSON.parse(localStorage.getItem('omni_intel_db')) || [];
    let tempAssocs = [];

    function showSection(id, btn) {
        document.querySelectorAll('.section').forEach(el => el.classList.remove('active'));
        document.querySelectorAll('.nav-btn').forEach(el => el.classList.remove('active'));
        document.getElementById(id).classList.add('active');
        if(btn) btn.classList.add('active');
        if(id === 'dashboard') renderDashboard();
    }

    function renderDashboard() {
        reports = JSON.parse(localStorage.getItem('omni_intel_db')) || [];
        
        // HUD Stats
        document.getElementById('totalCount').innerText = reports.length;
        
        let unique = new Set();
        reports.forEach(r => {
            unique.add(r.poiName);
            r.associates.forEach(a => unique.add(a));
        });
        document.getElementById('associateCount').innerText = unique.size;

        let alerts = reports.filter(r => r.type === 'SYNDICATE_ACTIVITY' || r.turnover > 8000).length;
        document.getElementById('alertCount').innerText = alerts;

        // Table
        const container = document.getElementById('table-container');
        let html = `<table class="data-table">
            <thead>
                <tr>
                    <th>TIMESTAMP</th>
                    <th>TARGET</th>
                    <th>CLASSIFICATION</th>
                    <th>LINKED_ENTITIES</th>
                    <th>ASSET</th>
                </tr>
            </thead>
            <tbody>`;
        
        reports.slice(0, 10).forEach(r => {
            html += `
            <tr>
                <td style="color:var(--text-muted)">${r.time.slice(0,10)}</td>
                <td style="font-weight:bold; color:#fff;">${r.poiName}</td>
                <td><span class="tag-node ${r.type === 'SYNDICATE_ACTIVITY' ? 'tag-alert' : ''}">${r.type}</span></td>
                <td>${r.associates.length}</td>
                <td style="font-family:monospace">${r.asset || '--'}</td>
            </tr>`;
        });
        html += `</tbody></table>`;
        container.innerHTML = html;
    }

    // --- FORM HANDLERS ---
    function addAssociate() {
        const val = document.getElementById('assocInput').value.trim();
        if(val) {
            tempAssocs.push(val);
            document.getElementById('assocInput').value = "";
            renderTags();
        }
    }
    
    function renderTags() {
        const div = document.getElementById('assocTags');
        div.innerHTML = tempAssocs.map(a => `<span class="tag-node" style="border:1px solid var(--accent-cyan)">${a}</span>`).join(' ');
    }

    function submitReport(e) {
        e.preventDefault();
        const newEntry = {
            id: Date.now(),
            poiName: document.getElementById('poiName').value,
            poiId: document.getElementById('poiId').value,
            time: document.getElementById('incidentTime').value,
            type: document.getElementById('incidentType').value,
            narrative: document.getElementById('narrative').value,
            asset: document.getElementById('assetNum').value,
            turnover: document.getElementById('meterIn').value,
            win: document.getElementById('meterOut').value,
            associates: [...tempAssocs],
            files: [] // File logic simulated for demo
        };

        reports.unshift(newEntry);
        localStorage.setItem('omni_intel_db', JSON.stringify(reports));
        
        // Reset
        document.getElementById('smrForm').reset();
        tempAssocs = [];
        renderTags();
        alert("ENTRY ENCRYPTED AND LOGGED.");
        showSection('dashboard', document.querySelectorAll('.nav-btn')[0]);
    }

    // --- SEARCH & LINK ANALYSIS ---
    function runSearch() {
        const q = document.getElementById('searchInput').value.toLowerCase();
        const res = document.getElementById('searchResults');
        
        if(q.length < 2) { res.innerHTML = ""; return; }

        const hits = reports.filter(r => 
            r.poiName.toLowerCase().includes(q) || 
            r.associates.some(a => a.toLowerCase().includes(q)) ||
            (r.asset && r.asset.toLowerCase().includes(q))
        );

        if(hits.length === 0) {
            res.innerHTML = "<div style='padding:20px; color:var(--text-muted)'>NO MATCHES FOUND IN DATABASE.</div>";
            return;
        }

        let html = "";
        hits.forEach(h => {
            const isPrimary = h.poiName.toLowerCase().includes(q);
            
            html += `
            <div class="glass-panel intel-result">
                <div style="display:flex; justify-content:space-between; margin-bottom:10px;">
                    <span style="color:var(--accent-cyan); font-weight:bold;">${h.type}</span>
                    <span style="font-family:monospace; color:var(--text-muted)">${new Date(h.time).toLocaleString()}</span>
                </div>
                
                <div style="font-size:1.1rem; margin-bottom:10px;">
                    <i class="fa-solid fa-user-secret"></i> 
                    ${isPrimary ? `<span style="text-decoration:underline; text-decoration-color:var(--danger)">${h.poiName}</span> (TARGET)` : h.poiName}
                </div>

                <div style="background:rgba(0,0,0,0.3); padding:10px; border-left:2px solid var(--text-muted); font-style:italic; color:var(--text-muted)">
                    "${h.narrative}"
                </div>

                <div style="margin-top:15px;">
                    <div style="font-size:0.8rem; margin-bottom:5px; color:var(--accent-cyan)">NETWORK_CONNECTIONS:</div>
                    ${h.associates.length > 0 ? 
                        h.associates.map(a => `<span class="tag-node ${a.toLowerCase().includes(q) ? 'tag-alert' : ''}">${a}</span>`).join('') 
                        : '<span style="color:var(--text-muted)">// NO KNOWN ASSOCIATES</span>'}
                </div>

                ${h.asset ? `<div style="margin-top:10px; font-size:0.8rem; font-family:monospace">
                    MACHINE: ${h.asset} | IN: $${h.turnover} | OUT: $${h.win}
                </div>` : ''}
            </div>
            `;
        });
        res.innerHTML = html;
    }

    // INITIALIZE
    initSystem();

</script>
</body>
</html>
