<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reylo | Operations</title>
    <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@300;400;600;700&display=swap" rel="stylesheet">
    <style>
        body { background: #020203; color: white; font-family: 'Space Grotesk', sans-serif; display: flex; flex-direction: column; align-items: center; padding: 20px; overflow-x: hidden; }
        #particle-canvas { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -1; }
        #login-gate { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #000; z-index: 999; display: flex; flex-direction: column; justify-content: center; align-items: center; }
        .pin-input { padding: 15px; font-size: 1.5rem; text-align: center; letter-spacing: 5px; background: #111; border: 1px solid #333; color: white; border-radius: 8px; width: 200px; margin-bottom: 20px; }
        .enter-btn { padding: 12px 30px; background: #3b82f6; border: none; color: white; font-weight: bold; border-radius: 8px; cursor: pointer; }
        
        .container { width: 100%; max-width: 1200px; display: none; }
        .header { display: flex; justify-content: space-between; align-items: center; padding: 30px; background: rgba(10,10,16,0.8); border: 1px solid rgba(255,255,255,0.1); border-radius: 24px; margin-bottom: 30px; backdrop-filter: blur(20px); }
        .logo { font-size: 1.8rem; font-weight: 700; } .logo span { color: #3b82f6; }
        .admin-search { padding: 10px 15px; background: rgba(255,255,255,0.1); border: 1px solid #333; color: white; border-radius: 8px; width: 250px; }
        
        .tabs { display: flex; gap: 10px; margin-bottom: 20px; }
        .tab-btn { padding: 10px 20px; background: rgba(255,255,255,0.05); border: 1px solid #333; color: #888; border-radius: 8px; cursor: pointer; }
        .tab-btn.active { background: #3b82f6; color: white; }
        
        .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(350px, 1fr)); gap: 20px; }
        .card { background: rgba(20,20,25,0.9); border: 1px solid rgba(255,255,255,0.1); border-radius: 12px; overflow: hidden; display: flex; flex-direction: column; }
        .card-body { display: flex; padding: 20px; gap: 20px; }
        .poster { width: 150px; height: 220px; object-fit: cover; border-radius: 8px; }
        .info { flex: 1; }
        .title { font-size: 1.2rem; font-weight: 700; margin-bottom: 5px; }
        .actions { padding: 15px; border-top: 1px solid rgba(255,255,255,0.1); display: flex; justify-content: space-between; }
        
        .btn-complete { background: rgba(16,185,129,0.2); color: #10b981; border: 1px solid #10b981; padding: 8px 15px; border-radius: 6px; cursor: pointer; }
        .btn-delete { background: rgba(239,68,68,0.2); color: #ef4444; border: 1px solid #ef4444; padding: 8px 15px; border-radius: 6px; cursor: pointer; }

        @media (max-width: 600px) {
            .header { flex-direction: column; text-align: center; gap: 15px; }
            .grid { grid-template-columns: 1fr; }
            .card-body { flex-direction: column; align-items: center; text-align: center; }
            .poster { width: 180px; height: 270px; }
        }
    </style>
</head>
<body>
    <canvas id="particle-canvas"></canvas>

    <div id="login-gate">
        <div style="margin-bottom:10px;">SECURE ACCESS</div>
        <input type="password" id="pin-input" class="pin-input">
        <button onclick="checkPin()" class="enter-btn">ENTER</button>
    </div>

    <div class="container" id="dashboard">
        <div class="header">
            <div><div class="logo">REYLO <span>OPERATIONS</span></div><div style="font-size:0.8rem; color:#666;">System Online</div></div>
            <input type="text" class="admin-search" placeholder="Search..." onkeyup="filterCards(this.value)">
        </div>
        <div class="tabs">
            <button class="tab-btn active" onclick="switchView('active')">Active</button>
            <button class="tab-btn" onclick="switchView('completed')">History</button>
            <button class="tab-btn" onclick="switchView('reports')">Reports</button>
        </div>
        <div id="content-grid" class="grid"></div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.1.0/firebase-app.js";
        import { getFirestore, collection, getDocs, doc, deleteDoc, updateDoc, orderBy, query } from "https://www.gstatic.com/firebasejs/11.1.0/firebase-firestore.js";

        const firebaseConfig = { apiKey: "AIzaSyDJlsmsRNuIVDOIrgdRyaSClqXsLj94MB0", projectId: "vodrequest", appId: "1:603036227000:web:340e481b47eb70cc742b4d" };
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        let currentView = 'active';

        window.checkPin = function() {
            if(document.getElementById('pin-input').value === "2024") {
                document.getElementById('login-gate').style.display='none';
                document.getElementById('dashboard').style.display='block';
                loadData(); setInterval(() => loadData(true), 15000);
            } else { alert("Wrong PIN"); }
        }

        window.switchView = function(view) {
            currentView = view;
            document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active')); event.target.classList.add('active');
            loadData();
        }

        window.loadData = async function(bg = false) {
            const grid = document.getElementById('content-grid');
            if(!bg) grid.innerHTML = '<div style="padding:20px; color:#666;">Loading...</div>';
            
            let col = currentView === 'reports' ? 'reports' : 'requests';
            const q = query(collection(db, col), orderBy("timestamp", "desc"));
            const snap = await getDocs(q);
            
            grid.innerHTML = '';
            snap.forEach(doc => {
                const d = doc.data();
                const status = d.status || 'New';
                if(currentView === 'active' && status === 'Completed') return;
                if(currentView === 'completed' && status !== 'Completed') return;
                
                const card = document.createElement('div'); card.className = 'card';
                
                if(col === 'requests') {
                    let btn = currentView === 'completed' ? `<button onclick="del('${doc.id}', 'requests')" class="btn-delete">Delete</button>` : `<button onclick="comp('${doc.id}')" class="btn-complete">Complete</button>`;
                    card.innerHTML = `<div class="card-body"><img src="${d.Poster_URL||''}" class="poster"><div class="info"><div class="title">${d.Confirmed_Title||d.Search_Query}</div><div>${d.Year||''}</div><div style="margin-top:10px; font-size:0.9rem; color:#888;">${d.Plot||''}</div><div style="margin-top:10px; color:#3b82f6;">${d.Client_Name}</div></div></div><div class="actions"><a href="${d.IMDB_Link}" target="_blank" style="color:#f5c518; font-weight:bold;">IMDB</a>${btn}</div>`;
                } else {
                    card.innerHTML = `<div class="card-body"><div class="info"><div style="color:#ef4444; font-weight:bold;">${d.Issue_Type}</div><div class="title">${d.Channel_Name}</div><div style="margin-top:10px;">${d.Description}</div><div style="margin-top:10px; color:#888;">${d.Client_Email}</div></div></div><div class="actions"><span>${d.Source}</span><button onclick="del('${doc.id}', 'reports')" class="btn-delete">Resolve</button></div>`;
                }
                grid.appendChild(card);
            });
            const search = document.querySelector('.admin-search').value;
            if(search) window.filterCards(search);
        }

        window.comp = async (id) => { if(confirm("Mark Complete?")) { await updateDoc(doc(db, "requests", id), {status:"Completed"}); loadData(true); }};
        window.del = async (id, col) => { if(confirm("Delete Permanently?")) { await deleteDoc(doc(db, col, id)); loadData(true); }};
        window.filterCards = (txt) => { document.querySelectorAll('.card').forEach(c => c.style.display = c.innerText.toLowerCase().includes(txt.toLowerCase()) ? 'flex' : 'none'); }

        // BRIGHT PARTICLES
        const canvas = document.getElementById("particle-canvas");
        const ctx = canvas.getContext("2d");
        canvas.width = window.innerWidth; canvas.height = window.innerHeight;
        let particles = [];
        class P { constructor(){this.x=Math.random()*canvas.width;this.y=Math.random()*canvas.height;this.vx=Math.random()*1-0.5;this.vy=Math.random()*1-0.5;this.s=Math.random()*3+2} update(){this.x+=this.vx;this.y+=this.vy;if(this.x<0||this.x>canvas.width)this.vx*=-1;if(this.y<0||this.y>canvas.height)this.vy*=-1} draw(){ctx.fillStyle='#3b82f6';ctx.shadowBlur=15;ctx.shadowColor='#3b82f6';ctx.beginPath();ctx.arc(this.x,this.y,this.s,0,Math.PI*2);ctx.fill();ctx.shadowBlur=0;}}
        function loop(){ctx.clearRect(0,0,canvas.width,canvas.height);particles.forEach(p=>{p.update();p.draw(); particles.forEach(q=>{let dx=p.x-q.x,dy=p.y-q.y;if(dx*dx+dy*dy<20000){ctx.strokeStyle=`rgba(59,130,246,${1-(dx*dx+dy*dy)/20000})`;ctx.lineWidth=2;ctx.beginPath();ctx.moveTo(p.x,p.y);ctx.lineTo(q.x,q.y);ctx.stroke()}})});requestAnimationFrame(loop)}
        for(let i=0;i<100;i++)particles.push(new P()); loop();
        window.addEventListener('resize', ()=>{canvas.width=window.innerWidth;canvas.height=window.innerHeight});
    </script>
</body>
</html>
